<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>K-Level PDF Generator</title>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 8px; }
    select { padding: 6px 10px; margin-right: 4px; }
    .question-row { margin-bottom: 6px; }
  </style>
</head>
<body>
  <h2>K-Level Format PDF Generator</h2>

  <label>College: <input type="text" id="college" value="Government Arts College, Nandanam, Chennai-35"></label>
  <label>Department: <input type="text" id="department" value="III.B.SC.COMPUTER SCIENCE"></label>
  <label>Student Name: <input type="text" id="student" value="Minnalraja R"></label>
  <label>Register No: <input type="text" id="regno" value="2313111018022"></label>
  <label>Subject: <input type="text" id="subject" value="Big Data Analytics"></label>
  <label>Subject Code: <input type="text" id="subjectcode" value="224160"></label>
  <label>Total Questions: <input type="number" id="qcount" value="5" min="1" max="200"></label>
  <label>PDF File Name: <input type="text" id="filename" placeholder="KLevel_Output"></label>

  <div id="questions"></div>
  <button onclick="generatePDF()">Generate PDF</button>

  <script>
    const questionsDiv = document.getElementById('questions');
    const qcountInput = document.getElementById('qcount');

    function renderQuestions() {
      questionsDiv.innerHTML = '';
      const qcount = parseInt(qcountInput.value) || 1;
      for (let q=1; q<=qcount; q++) {
        const div = document.createElement('div');
        div.className = 'question-row';
        div.innerHTML = `Q.${q}: `;

        const select = document.createElement('select');
        select.innerHTML = `<option value="">â€”</option>
                            <option value="0">K1</option>
                            <option value="1">K2</option>
                            <option value="2">K3</option>
                            <option value="3">K4</option>
                            <option value="4">K5</option>
                            <option value="5">K6</option>`;
        div.appendChild(select);
        questionsDiv.appendChild(div);
      }
    }

    qcountInput.addEventListener('change', renderQuestions);
    renderQuestions();

    async function generatePDF() {
      const { PDFDocument, StandardFonts, rgb } = PDFLib;
      const pdfDoc = await PDFDocument.create();
      const font = await pdfDoc.embedFont(StandardFonts.Helvetica);

      let page = pdfDoc.addPage([595, 842]);
      const rowH = 30;
      let y = 800;
      const x0 = 50, colW = 70;

      function drawText(text, x, y, size=12) {
        page.drawText(text, { x, y, size, font, color: rgb(0,0,0) });
      }

      function drawCircle(cx, cy, filled=true) {
        if (filled) {
          page.drawEllipse({ x: cx, y: cy, xScale: 5, yScale: 5, color: rgb(0,0,0) });
        } else {
          page.drawEllipse({ x: cx, y: cy, xScale: 5, yScale: 5, borderColor: rgb(0,0,0), borderWidth: 1 });
        }
      }

      // Header
      drawText(document.getElementById("college").value, 150, y, 14);
      y -= 20;
      drawText("Department: " + document.getElementById("department").value, x0, y);
      y -= 15;
      drawText("Student Name: " + document.getElementById("student").value, x0, y);
      y -= 15;
      drawText("Register No: " + document.getElementById("regno").value, x0, y);
      y -= 15;
      drawText("Subject: " + document.getElementById("subject").value, x0, y);
      y -= 15;
      drawText("Subject Code: " + document.getElementById("subjectcode").value, x0, y);
      y -= 30;

      const headers = ["Q.No", "K1","K2","K3","K4","K5","K6"];

      function drawTableHeader() {
        headers.forEach((h,i) => drawText(h, x0 + i*colW, y));
        y -= rowH;
      }

      drawTableHeader();

      // Draw rows
      const selects = Array.from(questionsDiv.querySelectorAll('select'));
      selects.forEach((sel, idx) => {
        const qNo = idx+1;
        const chosen = sel.value ? parseInt(sel.value) : -1;

        drawText(String(qNo), x0, y);

        for (let k=0; k<6; k++) {
          const cx = x0 + (k+1)*colW + 15;
          const cy = y + rowH/2 - 5;
          drawCircle(cx, cy, k === chosen);
        }

        y -= rowH;
        if (y < 50) { // New page
          page = pdfDoc.addPage([595,842]);
          y = 780;
          drawTableHeader();
        }
      });

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const a = document.createElement("a");
      const filename = document.getElementById("filename").value.trim() || "KLevel_Output";
      a.href = URL.createObjectURL(blob);
      a.download = filename + ".pdf";
      a.click();
    }
  </script>
</body>
</html>
